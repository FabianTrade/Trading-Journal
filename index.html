<script>
    // Nutze exakt diese Variablen
    const S_URL = 'https://epomvhikguclvpqzxhn.supabase.co';
    const S_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVwb212aGlrZ3VjbHZwb2d6eGhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwNzQ5MzcsImV4cCI6MjA4NjY1MDkzN30.559MP90eDQfyGN8ZL_6Dl8SYpNOs6JxYMnW_wJUCBXI';

    // Initialisierung
    const db = supabase.createClient(S_URL, S_KEY);

    async function saveTrade() {
        const trade = {
            instrument: document.getElementById('instrument').value,
            direction: document.getElementById('direction').value,
            size: parseFloat(document.getElementById('size').value) || 0,
            entry_price: parseFloat(document.getElementById('entry_price').value) || 0,
            result: parseFloat(document.getElementById('result').value) || 0,
            setup: document.getElementById('setup').value
        };

        // Versuch mit Fetch-API direkt (manchmal stabiler als die Library)
        try {
            const response = await fetch(`${S_URL}/rest/v1/trades`, {
                method: 'POST',
                headers: {
                    'apikey': S_KEY,
                    'Authorization': `Bearer ${S_KEY}`,
                    'Content-Type': 'application/json',
                    'Prefer': 'return=minimal'
                },
                body: JSON.stringify(trade)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message);
            }

            alert('Erfolg! Position gespeichert.');
            fetchTrades();
        } catch (err) {
            console.error(err);
            alert('Immer noch Blockiert. Bitte lies den Text unter dem Code!');
        }
    }
    
    // ... Rest der fetchTrades Funktion bleibt gleich ...
</script>
